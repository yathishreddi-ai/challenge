<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Indian Law Library — IPC Ready Dashboard</title>
<style>
  :root{--bg:#071126;--panel:#0d1b2a;--soft:#112536;--muted:#98a6bf;--text:#e6eef8;--accent:#3fb0ff;--radius:12px}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text);min-height:100vh}
  .app{display:grid;grid-template-columns:320px 1fr;gap:14px;padding:14px}
  .sidebar{background:var(--panel);padding:12px;border-radius:12px;height:calc(100vh - 28px);overflow:auto}
  .card{background:var(--panel);padding:12px;border-radius:12px}
  .sub{color:var(--muted);font-size:13px}
  input,textarea,select,button{font-family:inherit}
  .btn{padding:8px 12px;border-radius:10px;border:0;background:linear-gradient(135deg,var(--accent),#6de3c6);color:#052019;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.06)}
  textarea{width:100%;min-height:110px;padding:8px;border-radius:8px;background:#0f2434;border:1px solid rgba(255,255,255,.04);color:var(--text)}
  .list{max-height:380px;overflow:auto;margin-top:8px}
  .item{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,.03);margin-bottom:8px;background:linear-gradient(180deg, rgba(255,255,255,.01), transparent)}
  .muted{color:var(--muted);font-size:13px}
  footer{font-size:12px;color:var(--muted);padding:10px}
  @media(max-width:980px){.app{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar card">
    <div style="display:flex;gap:10px;align-items:center;margin-bottom:8px">
      <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#6de3c6)"></div>
      <div>
        <div style="font-weight:700">Indian Law Library</div>
        <div class="sub">IPC-ready dashboard — import full IPC JSON to enable full searching</div>
      </div>
    </div>

    <div style="margin-top:10px">
      <div style="font-weight:600">Quick actions</div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <button id="downloadSample" class="btn ghost">Download sample IPC JSON</button>
        <label class="btn ghost" style="cursor:pointer;display:inline-block;text-align:center">
          Import Full IPC (JSON)
          <input id="fileInput" type="file" accept="application/json" style="display:none"/>
        </label>
        <button id="pasteImport" class="btn ghost">Paste IPC JSON</button>
        <button id="exportIPC" class="btn ghost">Export Imported IPC</button>
        <button id="clearIPC" class="btn ghost">Clear Imported IPC</button>
      </div>
    </div>

    <hr style="border:none;border-top:1px solid rgba(255,255,255,.04);margin:12px 0" />

    <div style="font-weight:600">Notes</div>
    <div class="sub" style="margin-top:6px">Embedding the entire IPC into HTML makes the file large. Use the import tool to add full IPC JSON (recommended). Imported IPC is stored in your browser localStorage only.</div>
  </aside>

  <main>
    <section class="card" style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-weight:700;font-size:18px">Issue Finder — IPC & Articles</div>
        <div class="sub">Type the activity; the app will match Constitution Articles and any imported IPC sections.</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div style="background:#0f2434;padding:8px;border-radius:8px;display:flex;align-items:center;gap:8px">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.3-4.3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <input id="globalSearch" placeholder="Search articles, acts, IPC..." style="background:transparent;border:0;color:var(--text);outline:none;width:320px" />
        </div>
      </div>
    </section>

    <div style="margin-top:12px;display:grid;grid-template-columns:1fr 420px;gap:12px">
      <div>
        <section class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><div style="font-weight:700">Describe the activity</div><div class="sub">e.g., "stolen from my shop", "police arrested without warrant"</div></div>
            <div style="display:flex;gap:8px">
              <button id="analyzeBtn" class="btn">Analyze</button>
              <button id="clearIssue" class="btn ghost">Clear</button>
            </div>
          </div>
          <textarea id="issueText" placeholder="Type incident or activity here..."></textarea>
          <div id="analysisResults" style="margin-top:12px"></div>
        </section>

        <section class="card" style="margin-top:12px">
          <div><div style="font-weight:700">Sample IPC sections preloaded</div><div class="sub">These sections are built in so the app is immediately useful</div></div>
          <div class="list" id="sampleSections"></div>
        </section>
      </div>

      <aside>
        <section class="card">
          <div style="display:flex;justify-content:space-between;align-items:center"><div style="font-weight:700">Imported IPC / Full-Acts Library</div><div class="sub" id="ipcCount">No IPC imported</div></div>
          <div id="fullActsList" class="list"></div>
        </section>

        <section class="card" style="margin-top:12px">
          <div style="font-weight:700">Books & Acts</div>
          <div class="sub" style="margin-top:8px">Quick links to bare acts + books (lightweight)</div>
          <div class="list" id="actsList"></div>
        </section>
      </aside>
    </div>

    <footer style="margin-top:12px" class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="sub">Free to use — educational only. Imported IPC stored locally in your browser.</div>
        <div class="sub">You can export/import IPC JSON for offline sharing.</div>
      </div>
    </footer>
  </main>
</div>

<script>
/* ---------- small built-in sample to start with (important IPC sections) ---------- */
const SAMPLE_IPC = {
  code: 'IPC',
  title: 'Indian Penal Code, 1860 (sample sections)',
  sections: [
    { section: '302', title: 'Punishment for murder', text: 'Whoever commits murder shall be punished with death, or imprisonment for life, and shall also be liable to fine.'},
    { section: '376', title: 'Punishment for rape', text: 'Whoever commits rape shall be punished with rigorous imprisonment...' },
    { section: '375', title: 'Rape (definition)', text: 'A man is said to commit "rape" if he has sexual intercourse...' },
    { section: '420', title: 'Cheating and dishonestly inducing delivery of property', text: 'Whoever cheats and thereby dishonestly induces any person to deliver any property...' },
    { section: '390', title: 'Robbery', text: 'Robbery is theft accompanied by violence or threat of violence.' },
    { section: '506', title: 'Punishment for criminal intimidation', text: 'Whoever commits the offence of criminal intimidation shall be punished...' }
  ]
};

/* ---------- small constitutional articles array (Part III highlights) ---------- */
const ARTICLES_FULL = [
  {id:14, title:'Article 14', text:'Equality before the law and equal protection of the laws.'},
  {id:19, title:'Article 19', text:'Protection of certain rights regarding freedom of speech, assembly, movement, etc.'},
  {id:20, title:'Article 20', text:'Protection in respect of conviction for offences.'},
  {id:21, title:'Article 21', text:'Protection of life and personal liberty.'},
  {id:32, title:'Article 32', text:'Right to constitutional remedies (move Supreme Court).'}
];

/* ---------- basic ACTS list (lightweight) ---------- */
const ACTS = [
  { code:'IPC', title:'Indian Penal Code, 1860', url:'https://www.indiacode.nic.in/', summary:'Criminal offences — murder, rape, theft, cheating, etc.' },
  { code:'CrPC', title:'Code of Criminal Procedure, 1973', url:'https://www.indiacode.nic.in/', summary:'Procedure for investigation, arrest, bail, trial.' },
  { code:'Evidence', title:'Indian Evidence Act, 1872', url:'https://www.indiacode.nic.in/', summary:'Law of evidence.' }
];

/* ---------- application state (stored in localStorage) ---------- */
const state = {
  fullActs: JSON.parse(localStorage.getItem('fullActs')||'{}')  // map: code -> act object {code,title,sections:[{section,title,text}]}
};

function saveState(){ localStorage.setItem('fullActs', JSON.stringify(state.fullActs)); }

/* ---------- render helpers ---------- */
function el(tag, attrs={}, ...children){
  const n = document.createElement(tag);
  for(const k in attrs){
    if(k==='class') n.className = attrs[k];
    else if(k==='html') n.innerHTML = attrs[k];
    else n.setAttribute(k, attrs[k]);
  }
  children.forEach(c=>{ if(c==null) return; n.appendChild(typeof c === 'string' ? document.createTextNode(c) : c); });
  return n;
}

/* ---------- initial UI population ---------- */
function renderSampleSections(){
  const wrap = document.getElementById('sampleSections'); wrap.innerHTML = '';
  SAMPLE_IPC.sections.forEach(s=>{
    wrap.appendChild(el('div',{class:'item'}, el('div',{style:'font-weight:700'}, `§${s.section} — ${s.title}`), el('div',{class:'muted'}, s.text), el('div',{style:'margin-top:8px'}, el('button',{class:'btn ghost', onclick:()=> openSection('IPC', s.section, s.title, s.text)}, 'Open'))));
  });
}
function renderActsList(){
  const wrap = document.getElementById('actsList'); wrap.innerHTML = '';
  ACTS.forEach(a=>{
    wrap.appendChild(el('div',{class:'item'}, el('div',{style:'font-weight:700'}, `${a.code} — ${a.title}`), el('div',{class:'muted'}, a.summary), el('div',{style:'margin-top:8px',display:'flex',gap:'8px'}, el('a',{href:a.url,target:'_blank',class:'btn'}, 'Open Bare Act'))));
  });
}
function renderFullActsList(){
  const wrap = document.getElementById('fullActsList'); wrap.innerHTML = '';
  const keys = Object.keys(state.fullActs || {});
  const ipcCountEl = document.getElementById('ipcCount');
  if(!keys.length){ ipcCountEl.textContent = 'No IPC imported'; wrap.innerHTML = '<div class="muted">No imported acts.</div>'; return; }
  ipcCountEl.textContent = `${keys.length} imported act(s)`;
  keys.forEach(code=>{
    const act = state.fullActs[code];
    wrap.appendChild(el('div',{class:'item'}, el('div',{style:'font-weight:700'}, `${act.code} — ${act.title}`), el('div',{class:'muted'}, `${(act.sections||[]).length} sections`), el('div',{style:'margin-top:8px',display:'flex',gap:'8px'}, el('button',{class:'btn', onclick:()=> viewAct(act.code)}, 'View'), el('button',{class:'btn ghost', onclick:()=> exportAct(act.code)}, 'Export'))));
  });
}

/* ---------- open a section preview (overlay) ---------- */
function openSection(actCode, section, title, text){
  const overlay = el('div',{style:'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:999'});
  const box = el('div',{style:'width:min(920px,96vw);max-height:90vh;overflow:auto;background:#0f2434;padding:16px;border-radius:10px'}, 
    el('div',{style:'display:flex;justify-content:space-between;align-items:center'}, el('div',{}, el('div',{style:'font-weight:700'}, `${actCode} §${section} — ${title}`), el('div',{class:'muted', style:'margin-top:6px'}, text)), el('div',{}, el('button',{class:'btn ghost', onclick:()=> overlay.remove()}, 'Close')))
  );
  overlay.appendChild(box);
  document.body.appendChild(overlay);
}

/* ---------- view act sections modal ---------- */
function viewAct(code){
  const act = state.fullActs[code];
  if(!act) return alert('Act not found');
  const overlay = el('div',{style:'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:999'});
  const box = el('div',{style:'width:min(1000px,96vw);max-height:90vh;overflow:auto;background:#0f2434;padding:16px;border-radius:10px'});
  box.appendChild(el('div',{}, el('div',{style:'font-weight:700'}, `${act.code} — ${act.title}`), el('div',{class:'muted'}, `${(act.sections||[]).length} sections`), el('div',{style:'margin-top:8px'}, el('button',{class:'btn ghost', onclick:()=> overlay.remove()}, 'Close'))));
  const list = el('div',{style:'margin-top:12px'});
  (act.sections||[]).forEach(sec=>{
    list.appendChild(el('div',{class:'item'}, el('div',{style:'font-weight:700'}, `§${sec.section} — ${sec.title || ''}`), el('div',{class:'muted'}, sec.text.slice(0,400) + (sec.text.length>400 ? '...' : '')), el('div',{style:'margin-top:8px'}, el('button',{class:'btn', onclick:()=> openSection(act.code, sec.section, sec.title || '', sec.text)}, 'Open'))));
  });
  box.appendChild(list);
  overlay.appendChild(box);
  document.body.appendChild(overlay);
}

/* ---------- export single act JSON ---------- */
function exportAct(code){
  const act = state.fullActs[code];
  if(!act) return alert('Act not found');
  const blob = new Blob([JSON.stringify(act, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `${act.code}.json`; a.click();
  setTimeout(()=> URL.revokeObjectURL(url), 1500);
}

/* ---------- import from file input ---------- */
document.getElementById('fileInput').addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=>{
    try{
      const obj = JSON.parse(reader.result);
      // Accept either a single act {code,title,sections:[]} or an object map code->act
      if(Array.isArray(obj)){
        obj.forEach(a=>{ if(a.code) state.fullActs[a.code] = a; });
      } else if(obj.code){
        state.fullActs[obj.code] = obj;
      } else {
        // maybe map
        Object.assign(state.fullActs, obj);
      }
      saveState(); renderFullActsList(); alert('Imported successfully.');
    }catch(err){
      alert('Invalid JSON: ' + err.message);
    }
  };
  reader.readAsText(f);
});

/* ---------- paste import dialog ---------- */
document.getElementById('pasteImport').addEventListener('click', ()=>{
  const overlay = el('div',{style:'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:999'});
  const box = el('div',{style:'width:min(920px,96vw);background:#0f2434;padding:12px;border-radius:10px'});
  const ta = el('textarea',{placeholder:'Paste full IPC JSON here (object or array of acts)'}); ta.style.height = '260px';
  const status = el('div',{class:'muted', style:'margin-top:8px'});
  const btnRow = el('div',{style:'display:flex;gap:8px;margin-top:8px'}, el('button',{class:'btn', onclick:()=>{ try{ const obj = JSON.parse(ta.value); if(Array.isArray(obj)){ obj.forEach(a=>{ if(a.code) state.fullActs[a.code]=a; }); } else if(obj.code){ state.fullActs[obj.code]=obj; } else { Object.assign(state.fullActs,obj); } saveState(); renderFullActsList(); overlay.remove(); alert('Imported from paste'); }catch(err){ status.textContent = 'Invalid JSON: '+err.message; } }}, 'Import'), el('button',{class:'btn ghost', onclick:()=> overlay.remove()}, 'Cancel'));
  box.appendChild(el('div',{}, el('div',{style:'font-weight:700'}, 'Paste IPC JSON'), el('div',{class:'muted'}, 'You can paste a JSON object for IPC or an array containing act objects.')));
  box.appendChild(ta); box.appendChild(status); box.appendChild(btnRow);
  overlay.appendChild(box); document.body.appendChild(overlay);
});

/* ---------- sample download button ---------- */
document.getElementById('downloadSample').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(SAMPLE_IPC,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'sample-ipc.json'; a.click();
  setTimeout(()=> URL.revokeObjectURL(url),1500);
});

/* ---------- export all imported IPC ---------- */
document.getElementById('exportIPC').addEventListener('click', ()=>{
  if(!Object.keys(state.fullActs||{}).length) return alert('No imported acts to export');
  const blob = new Blob([JSON.stringify(state.fullActs,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'full-acts-library.json'; a.click();
  setTimeout(()=> URL.revokeObjectURL(url),1500);
});

/* ---------- clear IPC ---------- */
document.getElementById('clearIPC').addEventListener('click', ()=>{
  if(!confirm('Clear all imported full Acts from local storage?')) return;
  state.fullActs = {}; saveState(); renderFullActsList(); alert('Cleared imported acts');
});

/* ---------- analyze issue (search Articles + imported IPC) ---------- */
function tokenize(text){ return (text||'').toLowerCase().split(/[^a-z0-9]+/).filter(Boolean); }
function scoreMatch(keys,tokens){ let score=0; const ks = (keys||[]).map(k=>String(k).toLowerCase()); tokens.forEach(t=>{ if(ks.includes(t)) score+=1; else ks.forEach(k=>{ if(k.includes(t) || t.includes(k)) score+=0.4; }); }); return score; }

document.getElementById('analyzeBtn').addEventListener('click', ()=>{
  const t = document.getElementById('issueText').value.trim(); if(!t){ alert('Type an activity/incident first'); return; }
  analyzeIssue(t);
});

function analyzeIssue(text){
  const tokens = tokenize(text);
  const results = document.getElementById('analysisResults'); results.innerHTML = '';
  // match Articles (small built-in)
  const artScores = ARTICLES_FULL.map(a=> ({...a,score: scoreMatch([a.id, a.title].concat(a.text.split(/[^a-z0-9]+/i)), tokens)})).sort((a,b)=>b.score-a.score);
  const topArts = artScores.filter(a=>a.score>0).slice(0,8);
  if(topArts.length){
    results.appendChild(el('div',{}, el('div',{style:'font-weight:700'}, 'Relevant Constitutional Articles')));
    topArts.forEach(a=> results.appendChild(el('div',{class:'item'}, el('div',{style:'font-weight:700'}, `Article ${a.id} — ${a.title}`), el('div',{class:'muted'}, a.text), el('div',{style:'margin-top:8px'}, el('button',{class:'btn ghost', onclick:()=> openArticle(a.id)}, 'Read'))))));
  }

  // search in imported full acts
  const fullMatches = [];
  Object.values(state.fullActs||{}).forEach(act=>{
    (act.sections||[]).forEach(sec=>{
      const combined = (sec.section + ' ' + (sec.title||'') + ' ' + sec.text).toLowerCase();
      if(tokens.some(tok => combined.includes(tok))) fullMatches.push({act:act.code, section:sec.section, title:sec.title, text:sec.text});
    });
  });
  if(fullMatches.length){
    results.appendChild(el('div',{}, el('div',{style:'font-weight:700;margin-top:10px'}, 'Matches in imported Acts')));
    fullMatches.slice(0,30).forEach(m=> results.appendChild(el('div',{class:'item'}, el('div',{style:'font-weight:700'}, `${m.act} §${m.section} — ${m.title||''}`), el('div',{class:'muted'}, m.text.slice(0,500) + (m.text.length>500 ? '...' : '')), el('div',{style:'margin-top:8px'}, el('button',{class:'btn', onclick:()=> openSection(m.act, m.section, m.title||'', m.text)}, 'Open Section'))))));
  }

  // Suggest using sample IPC sections if no full match:
  if(!topArts.length && !fullMatches.length){
    results.appendChild(el('div',{class:'muted'}, 'No direct matches found in imported Acts. You can: 1) Import full IPC JSON using the Import button, 2) Try keywords like "arrest", "murder", "cheating", "rape".'));
  }
}

/* ---------- open article quick modal ---------- */
function openArticle(id){
  const a = ARTICLES_FULL.find(x=>x.id===id); if(!a) return;
  const overlay = el('div',{style:'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:999'});
  const box = el('div',{style:'width:min(820px,96vw);max-height:90vh;overflow:auto;background:#0f2434;padding:16px;border-radius:10px'}, el('div',{}, el('div',{style:'font-weight:700'}, `Article ${a.id} — ${a.title}`), el('div',{class:'muted', style:'margin-top:8px'}, a.text), el('div',{style:'margin-top:12px'}, el('button',{class:'btn ghost', onclick:()=> overlay.remove()}, 'Close'))));
  overlay.appendChild(box); document.body.appendChild(overlay);
}

/* ---------- initial render ---------- */
renderSampleSections(); renderActsList(); renderFullActsList();

/* ---------- wire global search to filter imported acts and books (quick) ---------- */
document.getElementById('globalSearch').addEventListener('input', (e)=>{
  const q = e.target.value.trim().toLowerCase();
  // quick highlight: if q matches an imported act code, show it
  if(!q) { renderFullActsList(); return; }
  const matches = Object.values(state.fullActs||{}).filter(a => (a.code + ' ' + a.title).toLowerCase().includes(q));
  const wrap = document.getElementById('fullActsList'); wrap.innerHTML = '';
  if(matches.length) matches.forEach(act => wrap.appendChild(el('div',{class:'item'}, el('div',{style:'font-weight:700'}, `${act.code} — ${act.title}`), el('div',{class:'muted'}, `${(act.sections||[]).length} sections`), el('div',{}, el('button',{class:'btn', onclick:()=> viewAct(act.code)}, 'View')))));
  else wrap.innerHTML = '<div class="muted">No imported acts match search.</div>';
});
</script>
</body>
</html>
