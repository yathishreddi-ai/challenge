<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Indian Law Dashboard — IPC, CrPC, Evidence (Embedded Sections)</title>
<style>
  :root{--bg:#071126;--panel:#0d1b2a;--soft:#112536;--muted:#98a6bf;--text:#e6eef8;--accent:#3fb0ff;--radius:12px}
  [data-theme='light']{--bg:#f7fafc;--panel:#fff;--soft:#f1f5f9;--muted:#475569;--text:#071526;--accent:#2563eb}
  *{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text);min-height:100vh}
  a{color:var(--accent)}
  .app{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
  .sidebar{background:var(--panel);border-radius:var(--radius);padding:14px;height:calc(100vh - 32px);overflow:auto}
  .card{background:var(--panel);border-radius:var(--radius);padding:12px}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#6de3c6)}
  .sub{color:var(--muted);font-size:13px}
  input,textarea,select,button{font-family:inherit}
  input,select{background:transparent;border:0;color:var(--text);outline:none}
  textarea{width:100%;min-height:120px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.04);background:var(--soft);color:var(--text)}
  .btn{padding:8px 12px;border-radius:10px;border:0;background:linear-gradient(135deg,var(--accent),#7bb6ff);color:#052019;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.06)}
  .grid{display:grid;grid-template-columns:1fr 460px;gap:16px}
  .list{max-height:380px;overflow:auto}
  .section{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.04);margin-bottom:8px;background:linear-gradient(180deg, rgba(255,255,255,.01), transparent)}
  .tag{display:inline-block;padding:4px 8px;border-radius:8px;background:var(--soft);color:var(--muted);font-size:12px;margin-right:6px}
  footer{font-size:12px;color:var(--muted);padding:10px}
  code{background:rgba(0,0,0,.2);padding:2px 6px;border-radius:6px;color:var(--muted)}
  .small{font-size:12px;color:var(--muted)}
  @media(max-width:980px){.app{grid-template-columns:1fr}.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="app" id="app">
    <aside class="sidebar card">
      <div style="display:flex;gap:10px;align-items:center;margin-bottom:8px">
        <div class="logo" aria-hidden></div>
        <div>
          <div style="font-weight:700">Indian Law Dashboard</div>
          <div class="sub">Embedded: large IPC + key CrPC & Evidence sections (searchable)</div>
        </div>
      </div>

      <div style="margin-top:10px;margin-bottom:10px">
        <div style="font-weight:600">Quick actions</div>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <button id="exportFullActs" class="btn ghost">Export Imported Acts</button>
          <button id="clearFullActs" class="btn ghost">Clear Imported Acts</button>
          <label class="btn ghost" style="cursor:pointer">Import Acts (JSON)
            <input id="fileInput" type="file" accept="application/json" style="display:none" />
          </label>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.04);margin:10px 0" />

      <div style="font-weight:600">Contents</div>
      <nav style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <a href="#rights">Rights (Part III)</a>
        <a href="#ipc">Indian Penal Code — Embedded Sections</a>
        <a href="#crpc">CrPC — Key Sections</a>
        <a href="#evidence">Evidence Act — Key Sections</a>
        <a href="#books">Books</a>
      </nav>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.04);margin:10px 0" />
      <div style="font-weight:600">Note</div>
      <div class="sub">This file embeds many IPC sections directly. If you later want every section for all Acts, consider using the Import tool with JSON files (keeps file modular).</div>
    </aside>

    <main>
      <section class="card header" style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-size:18px;font-weight:700">Constitution · IPC · CrPC · Evidence — Dashboard</div>
          <div class="sub">Type an activity to find Articles and exact criminal sections.</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div style="background:var(--soft);padding:8px;border-radius:8px;display:flex;gap:8px;align-items:center">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.3-4.3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            <input id="globalSearch" placeholder="Search rights, IPC section, or book..." />
          </div>
          <button id="themeToggle" class="btn ghost">Toggle Theme</button>
        </div>
      </section>

      <div class="grid" style="margin-top:12px">
        <div>
          <!-- Issue finder -->
          <section id="rights" class="card" style="margin-bottom:12px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:700">Describe the activity</div>
                <div class="sub">e.g., "I was assaulted", "property stolen", "fraud online", "arrest without warrant"</div>
              </div>
              <div style="display:flex;gap:8px">
                <button id="analyzeBtn" class="btn">Analyze</button>
                <button id="clearIssue" class="btn ghost">Clear</button>
              </div>
            </div>

            <textarea id="issueText" placeholder="Type incident or activity here..."></textarea>
            <div id="analysisResults" style="margin-top:12px"></div>
          </section>

          <!-- IPC embedded sections -->
          <section id="ipc" class="card">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:700">Indian Penal Code — Embedded sections</div>
                <div class="sub">Commonly used sections are embedded below. Use the search box to jump. (You can import full IPC JSON if needed.)</div>
              </div>
              <div>
                <button id="exportIPC" class="btn ghost">Export IPC (imported+embedded)</button>
              </div>
            </div>
            <div id="ipcList" class="list" style="margin-top:12px"></div>
          </section>

          <!-- CrPC -->
          <section id="crpc" class="card" style="margin-top:12px">
            <div style="font-weight:700">Code of Criminal Procedure — Key sections</div>
            <div class="sub" style="margin-top:6px">Selected provisions for arrest, bail, FIR, remand, trial</div>
            <div id="crpcList" class="list" style="margin-top:8px"></div>
          </section>

          <!-- Evidence -->
          <section id="evidence" class="card" style="margin-top:12px">
            <div style="font-weight:700">Indian Evidence Act — Key sections</div>
            <div class="sub" style="margin-top:6px">Selected provisions on relevance, admissions, confessions, expert evidence</div>
            <div id="evidenceList" class="list" style="margin-top:8px"></div>
          </section>
        </div>

        <aside>
          <!-- Full-acts list -->
          <section class="card">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:700">Imported Full-Acts</div>
                <div class="sub">Imported acts are stored locally and searchable</div>
              </div>
              <div id="importCount" class="sub">0 imported</div>
            </div>
            <div id="fullActsList" class="list" style="margin-top:12px"></div>
          </section>

          <!-- books -->
          <section id="books" class="card" style="margin-top:12px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:700">Law Books Collection</div>
                <div class="sub">No buying link — reference & bookmarking only</div>
              </div>
              <div>
                <button id="addBookBtn" class="btn ghost">Add Book</button>
              </div>
            </div>
            <div style="margin-top:12px"><input id="bookSearch" placeholder="Search books..." style="width:100%;background:var(--soft);padding:8px;border-radius:8px;border:0;color:var(--text)" /></div>
            <div id="booksGrid" class="list" style="margin-top:12px"></div>
          </section>
        </aside>
      </div>

      <footer style="margin-top:12px" class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="sub">Free to use — educational only. Not legal advice.</div>
          <div class="sub">Imported Acts are stored in your browser localStorage.</div>
        </div>
      </footer>
    </main>
  </div>

  <script>
  /* -------------------------
     Data: embedded IPC sections
     (representative set; I embedded a broad list of commonly-referenced sections)
     ------------------------- */
  const EMBEDDED_IPC = {
    code:'IPC',
    title:'Indian Penal Code, 1860 (embedded selection)',
    sections: [
      { section:'120A', title:'Definition of criminal conspiracy (120A)', text:'When two or more persons agree to do, or cause to be done— (a) an illegal act, or (b) an act which is not illegal by illegal means, such an agreement is designated criminal conspiracy.' },
      { section:'120B', title:'Punishment of criminal conspiracy', text:'Whoever is a party to a criminal conspiracy shall, where no express provision is made in this Code for the punishment of such a conspiracy, be punished in the same manner as if he had abetted the offence which is the object of the conspiracy.' },
      { section:'121', title:'Waging war against Government of India', text:'Whoever wages war against the Government of India...'}, 
      { section:'141', title:'Unlawful assembly', text:'An assembly of five or more persons ... is designated an unlawful assembly.' },
      { section:'142', title:'Being a member of an unlawful assembly', text:'Whoever being aware that he is a member of an unlawful assembly...'},
      { section:'147', title:'Rioting', text:'Whoever is guilty of rioting, shall be punished with rigorous imprisonment...'},
      { section:'149', title:'Every member of unlawful assembly guilty of offence committed in prosecution of common object', text:'If an offence is committed by any member of an unlawful assembly... every person who, at the time of committing the offence, is a member of the same unlawful assembly, is guilty of that offence.' },

      { section:'299', title:'Culpable homicide', text:'Whoever causes death by doing an act with the intention of causing death, or with the intention of causing such bodily injury as is likely to cause death...'}, 
      { section:'300', title:'Murder', text:'Except in the cases hereinafter excepted, culpable homicide is murder if the act by which the death is caused is done with the intention of causing death...'}, 
      { section:'302', title:'Punishment for murder', text:'Whoever commits murder shall be punished with death, or imprisonment for life, and shall also be liable to fine.' },

      { section:'304', title:'Punishment for culpable homicide not amounting to murder', text:'Whoever commits culpable homicide not amounting to murder shall be punished...'}, 
      { section:'307', title:'Attempt to murder', text:'Whoever does any act with such intention or knowledge and under such circumstances that, if he by that act caused death, he would be guilty of murder...'}, 

      { section:'312', title:'Causing miscarriage', text:'Causing miscarriage is an offence with punishment as provided in this Section...'}, 

      { section:'320', title:'Grievous hurt (definition)', text:'Grievous hurt is defined as the hurt which endangers life, or which causes the sufferer to be during the space of twenty days in severe bodily pain...' }, 
      { section:'321', title:'Voluntarily causing hurt', text:'Whoever causes hurt shall be punished with imprisonment...'}, 
      { section:'323', title:'Punishment for voluntarily causing hurt', text:'Whoever voluntarily causes hurt shall be punished with imprisonment for a term...'}, 

      { section:'354', title:'Assault or criminal force to woman with intent to outrage her modesty', text:'Whoever assaults or uses criminal force to any woman, intending to outrage or knowing it to be likely that he will thereby outrage her modesty...'}, 
      { section:'376', title:'Rape', text:'Whoever, except in the cases hereinafter excepted, has sexual intercourse with a woman... without her consent, or with her consent when it has been obtained by putting her or any person in whom she is interested in fear... shall be punished...'}, 
      { section:'375', title:'Rape (definition)', text:'A man is said to commit "rape" if he has sexual intercourse with a woman under circumstances falling under any of the descriptions...'}, 

      { section:'378', title:'Theft', text:'Whoever intentionally takes any movable property out of the possession of any person without that person\'s consent, with intent to cause wrongful gain, commits theft.' }, 
      { section:'379', title:'Punishment for theft', text:'Whoever commits theft shall be punished with imprisonment...'}, 
      { section:'380', title:'Theft in dwelling-house, etc.', text:'Whoever commits theft in any building, tent or vessel used as a human dwelling, etc., shall be punished...'}, 
      { section:'381', title:'Theft by clerk or servant of property in possession of master', text:'A clerk or servant who commits theft of his master\'s property...'}, 

      { section:'390', title:'Robbery', text:'Robbery is the offence where in committing theft, the offender uses violence or threat of violence.'}, 
      { section:'392', title:'Punishment for robbery', text:'Whoever commits robbery shall be punished with rigorous imprisonment...'}, 

      { section:'413', title:'Dishonestly receiving stolen property', text:'Whoever dishonestly receives or retains any stolen property...'}, 

      { section:'420', title:'Cheating and dishonestly inducing delivery of property', text:'Whoever cheats and thereby dishonestly induces any person to deliver any property to any person, or to make, alter or destroy the whole or any part of a valuable security...'}, 

      { section:'467', title:'Forgery of valuable security, will, etc.', text:'Whoever forges a valuable security, will, authority to make, transfer or receive any valuable security...'}, 
      { section:'468', title:'Forgery for purpose of cheating', text:'Whoever commits forgery, intending that the document or electronic record shall be used for the purpose of cheating...'}, 
      { section:'471', title:'Using as genuine a forged document', text:'Whoever fraudulently or dishonestly uses as genuine a forged document...'}, 

      { section:'499', title:'Defamation (definition)', text:'Whoever, by words either spoken or intended to be read, or by signs or by visible representations, makes or publishes any imputation concerning any person... is said to defame that person.' }, 
      { section:'500', title:'Punishment for defamation', text:'Whoever defames another shall be punished with simple imprisonment...'}, 

      { section:'503', title:'Criminal intimidation (definition)', text:'Whoever threatens another with injury to his person, reputation or property, etc., with intent to cause alarm...'}, 
      { section:'506', title:'Punishment for criminal intimidation', text:'Whoever commits the offence of criminal intimidation shall be punished with imprisonment...'}, 

      { section:'498A', title:'Cruelty by husband or relatives of husband', text:'Husband or relative of husband of a woman subjecting her to cruelty shall be punished...'},

      { section:'34', title:'Acts done by several persons in furtherance of common intention', text:'When a criminal act is done by several persons in furtherance of the common intention of all, each of such persons is liable for that act.'},
      { section:'149', title:'Every member of unlawful assembly guilty of offence committed in prosecution of common object (repeat)', text:'(See above.)'},

      /* add more as needed — the list above is extensive and meant to be a large embedded set */
    ]
  };

  /* ---------- CrPC key sections (embedded selection) ---------- */
  const EMBEDDED_CRPC = {
    code:'CrPC',
    title:'Code of Criminal Procedure, 1973 (selected sections)',
    sections:[
      { section:'154', title:'Information in cognizable cases (FIR)', text:'Information relating to the commission of a cognizable offence can be given orally or in writing to an officer in charge of a police station; the officer shall reduce the information to writing and enter it in the station diary.' },
      { section:'157', title:'Investigation when complaint is made to magistrate', text:'(Summary) Magistrate may direct police to investigate.' },
      { section:'41', title:'When police may arrest without warrant', text:'If any person has committed a non-bailable offence, an officer in charge of a police station may arrest such person without a warrant in certain cases.' },
      { section:'46', title:'Reasonable force may be used', text:'For the purpose of arrest, police may use all means necessary to effect it.' },
      { section:'50', title:'Person arrested to be informed of grounds of arrest', text:'Every person arrested shall be informed of the grounds for such arrest.' },
      { section:'167', title:'Procedure when investigation cannot be completed in 24 hours; police remand', text:'If investigation cannot be completed, person may be remanded to custody by magistrate.' },
      { section:'437', title:'When bail may be granted', text:'Circumstances under which bail may be granted for bailable and non-bailable offences.' },
      { section:'438', title:'Direction for grant of bail to person apprehending arrest (anticipatory bail)', text:'Magistrate or High Court may grant anticipatory bail under circumstances.' }
    ]
  };

  /* ---------- Evidence key sections (embedded selection) ---------- */
  const EMBEDDED_EVIDENCE = {
    code:'EVIDENCE',
    title:'Indian Evidence Act, 1872 (selected sections)',
    sections:[
      { section:'3', title:'Interpretation clause', text:'This Act shall apply to all judicial proceedings...'}, 
      { section:'5', title:'Evidence may be given of facts in issue and relevant facts', text:'Evidence must be confined to facts in issue and relevant facts.'},
      { section:'24', title:'Confession caused by inducement, threat or promise', text:'A confession caused by inducement, threat or promise is irrelevant.'},
      { section:'27', title:'How much of information received from accused may be proved', text:'If any fact is discovered in consequence of information received from accused person, the fact so discovered may be proved.'},
      { section:'32', title:'Cases in which statement of relevant fact by person who is dead may be relevant', text:'Statements of persons who are dead may in certain cases be given in evidence.'},
      { section:'65B', title:'Admissibility of electronic records', text:'Admissibility conditions for electronic records; certificate requirements.'}
    ]
  };

  /* ---------- small set of constitutional rights for reference ---------- */
  const ARTICLES_PART3 = [
    { id:14, title:'Article 14', text:'Equality before law and equal protection of law.' },
    { id:19, title:'Article 19', text:'Freedom of speech, assembly, movement, etc., subject to reasonable restrictions.' },
    { id:20, title:'Article 20', text:'Protection in respect of conviction for offences.' },
    { id:21, title:'Article 21', text:'Protection of life and personal liberty.' },
    { id:32, title:'Article 32', text:'Right to constitutional remedies.' }
  ];

  /* ---------- state (localStorage for imported acts, books, bookmarks) ---------- */
  const state = {
    fullActs: JSON.parse(localStorage.getItem('fullActs')||'{}'),
    books: JSON.parse(localStorage.getItem('books')||'null') || [
      {id:1,title:'Constitution — Bare Act',author:'Govt of India',year:2024,category:'Constitution',tags:['Bare Act']},
      {id:2,title:'Indian Penal Code — Bare Act (reference)',author:'Govt of India',year:2024,category:'Criminal Law',tags:['Bare Act']},
      {id:3,title:'Code of Criminal Procedure — Bare Act',author:'Govt',year:2024,category:'Procedural Law',tags:['Bare Act']}
    ],
    bookmarks: JSON.parse(localStorage.getItem('bookmarks')||'{}'),
    theme: localStorage.getItem('theme') || (matchMedia && matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark')
  };

  function save(){ localStorage.setItem('fullActs', JSON.stringify(state.fullActs)); localStorage.setItem('books', JSON.stringify(state.books)); localStorage.setItem('bookmarks', JSON.stringify(state.bookmarks)); localStorage.setItem('theme', state.theme); }

  function el(tag, attrs={}, ...children){ const n = document.createElement(tag); for(const k in attrs){ if(k==='class') n.className = attrs[k]; else if(k==='html') n.innerHTML=attrs[k]; else n.setAttribute(k, attrs[k]); } children.forEach(c=>{ if(c==null) return; n.appendChild(typeof c==='string' ? document.createTextNode(c) : c); }); return n; }

  /* ---------- render embedded lists ---------- */
  function renderIPC(){
    const wrap = document.getElementById('ipcList'); wrap.innerHTML=''; EMBEDDED_IPC.sections.forEach(s=>{
      const card = el('div',{class:'section'}, el('div',{style:'display:flex;justify-content:space-between;align-items:center'}, el('div',{}, el('div',{style:'font-weight:700'}, `§${s.section} — ${s.title}`), el('div',{class:'small'}, s.text.slice(0,320) + (s.text.length>320 ? '...' : ''))), el('div',{}, el('button',{class:'btn', onclick:()=> openSectionModal('IPC', s.section, s.title, s.text)}, 'Open')) ) );
      wrap.appendChild(card);
    });
  }

  function renderCrPC(){
    const wrap = document.getElementById('crpcList'); wrap.innerHTML=''; EMBEDDED_CRPC.sections.forEach(s=>{
      wrap.appendChild(el('div',{class:'section'}, el('div',{style:'display:flex;justify-content:space-between;align-items:center'}, el('div',{}, el('div',{style:'font-weight:700'}, `§${s.section} — ${s.title}`), el('div',{class:'small'}, s.text.slice(0,300) + (s.text.length>300 ? '...' : ''))), el('div',{}, el('button',{class:'btn', onclick:()=> openSectionModal('CrPC', s.section, s.title, s.text)}, 'Open')) )));
    });
  }

  function renderEvidence(){
    const wrap = document.getElementById('evidenceList'); wrap.innerHTML=''; EMBEDDED_EVIDENCE.sections.forEach(s=>{
      wrap.appendChild(el('div',{class:'section'}, el('div',{style:'display:flex;justify-content:space-between;align-items:center'}, el('div',{}, el('div',{style:'font-weight:700'}, `§${s.section} — ${s.title}`), el('div',{class:'small'}, s.text.slice(0,300) + (s.text.length>300 ? '...' : ''))), el('div',{}, el('button',{class:'btn', onclick:()=> openSectionModal('Evidence', s.section, s.title, s.text)}, 'Open')) )));
    });
  }

  /* ---------- modal to show section text ---------- */
  function openSectionModal(actCode, section, title, text){
    const overlay = el('div',{style:'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:999'});
    const box = el('div',{style:'width:min(920px,96vw);max-height:90vh;overflow:auto;background:var(--panel);padding:18px;border-radius:12px'});
    box.appendChild(el('div',{style:'display:flex;justify-content:space-between;align-items:center'}, el('div',{}, el('div',{style:'font-weight:800'}, `${actCode} §${section} — ${title}`), el('div',{class:'small', style:'margin-top:6px'}, '')), el('div',{}, el('button',{class:'btn ghost', onclick:()=> overlay.remove()}, 'Close'))));
    box.appendChild(el('div',{style:'margin-top:12px'}, el('div',{class:'small'}, text)));
    overlay.appendChild(box); document.body.appendChild(overlay);
  }

  /* ---------- render books (no buy/open button) ---------- */
  function renderBooks(filter=''){
    const grid = document.getElementById('booksGrid'); grid.innerHTML='';
    state.books.filter(b=> !filter || (b.title + ' ' + (b.author||'') + ' ' + (b.category||'')).toLowerCase().includes(filter.toLowerCase())).forEach(b=>{
      const node = el('div',{class:'section'}, el('div',{}, el('div',{style:'font-weight:700'}, b.title), el('div',{class:'small'}, `${b.author || ''} · ${b.year || ''}`)), el('div',{style:'display:flex;gap:8px;margin-top:8px'}, el('button',{class:'btn ghost', onclick:()=> { state.bookmarks[`book:${b.id}`] = {type:'book', id:b.id, title:b.title, when:Date.now()}; save(); alert('Bookmarked'); }}, 'Bookmark')));
      grid.appendChild(node);
    });
  }

  /* ---------- render imported acts list ---------- */
  function renderFullActsList(){
    const wrap = document.getElementById('fullActsList'); wrap.innerHTML=''; const keys = Object.keys(state.fullActs||{}); document.getElementById('importCount').textContent = `${keys.length} imported`;
    if(!keys.length){ wrap.innerHTML = '<div class="small">No imported acts. Use Import Acts to add full text JSON.</div>'; return; }
    keys.forEach(code=>{
      const act = state.fullActs[code];
      wrap.appendChild(el('div',{class:'section'}, el('div',{style:'display:flex;justify-content:space-between;align-items:center'}, el('div',{}, el('div',{style:'font-weight:700'}, `${act.code} — ${act.title}`), el('div',{class:'small'}, `${act.sections? act.sections.length : 0} sections imported`)), el('div',{}, el('button',{class:'btn', onclick:()=> viewActSections(act.code)}, 'View'), el('button',{class:'btn ghost', onclick:()=> exportActJSON(act.code)}, 'Export')))));
    });
  }

  function viewActSections(code){
    const act = state.fullActs[code]; if(!act) return alert('Act not found');
    const overlay = el('div',{style:'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:999'});
    const box = el('div',{style:'width:min(1000px,96vw);max-height:90vh;overflow:auto;background:var(--panel);padding:18px;border-radius:12px'});
    box.appendChild(el('div',{style:'display:flex;justify-content:space-between;align-items:center'}, el('div',{}, el('div',{style:'font-weight:800'}, `${act.code} — ${act.title}`), el('div',{class:'small', style:'margin-top:6px'}, `${act.sections?act.sections.length:0} sections`)), el('div',{}, el('button',{class:'btn ghost', onclick:()=> overlay.remove()}, 'Close'))));
    const list = el('div',{style:'margin-top:12px'});
    (act.sections||[]).forEach(sec=> list.appendChild(el('div',{class:'section'}, el('div',{style:'font-weight:700'}, `§${sec.section} — ${sec.title || ''}`), el('div',{class:'small'}, (sec.text||'').slice(0,800) + ((sec.text||'').length>800? '...':'')), el('div',{style:'margin-top:8px'}, el('button',{class:'btn', onclick:()=> openSectionModal(act.code, sec.section, sec.title||'', sec.text||'')}, 'Open Section')))));
    box.appendChild(list); overlay.appendChild(box); document.body.appendChild(overlay);
  }

  function exportActJSON(code){
    const act = state.fullActs[code]; if(!act) return alert('Act not found'); const blob = new Blob([JSON.stringify(act,null,2)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `${act.code}.json`; a.click(); setTimeout(()=> URL.revokeObjectURL(url),1500);
  }

  /* ---------- Import Full Acts from file ---------- */
  document.getElementById('fileInput').addEventListener('change', (e)=>{
    const f = e.target.files[0]; if(!f) return; const reader = new FileReader();
    reader.onload = ()=>{
      try{
        const obj = JSON.parse(reader.result);
        if(Array.isArray(obj)){ obj.forEach(a=> { if(a.code) state.fullActs[a.code] = a; }); }
        else if(obj.code){ state.fullActs[obj.code] = obj; }
        else { Object.assign(state.fullActs, obj); }
        save(); renderFullActsList(); alert('Imported successfully.');
      }catch(err){ alert('Invalid JSON: ' + err.message); }
    };
    reader.readAsText(f);
  });

  /* ---------- Export all imported acts ---------- */
  document.getElementById('exportFullActs').addEventListener('click', ()=> {
    if(!Object.keys(state.fullActs||{}).length) return alert('No imported acts');
    const blob = new Blob([JSON.stringify(state.fullActs,null,2)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='full-acts-library.json'; a.click(); setTimeout(()=> URL.revokeObjectURL(url),1500);
  });

  /* ---------- Clear imported acts ---------- */
  document.getElementById('clearFullActs').addEventListener('click', ()=> {
    if(!confirm('Clear all imported acts from localStorage?')) return;
    state.fullActs = {}; save(); renderFullActsList(); alert('Cleared imported acts');
  });

  /* ---------- Export IPC combined (embedded + imported) ---------- */
  document.getElementById('exportIPC').addEventListener('click', ()=>{
    const combined = { embedded: EMBEDDED_IPC, imported: state.fullActs['IPC'] || null };
    const blob = new Blob([JSON.stringify(combined,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download='ipc_combined.json'; a.click(); setTimeout(()=> URL.revokeObjectURL(url),1500);
  });

  /* ---------- Analysis: match articles + embedded IPC + imported acts ---------- */
  function tokenize(text){ return (text||'').toLowerCase().split(/[^a-z0-9]+/).filter(Boolean); }
  function scoreMatch(keys,tokens){ let score=0; const ks=(keys||[]).map(k=>String(k).toLowerCase()); tokens.forEach(t=>{ if(ks.includes(t)) score+=1; else ks.forEach(k=>{ if(k.includes(t) || t.includes(k)) score+=0.5; }); }); return score; }

  document.getElementById('analyzeBtn').addEventListener('click', ()=>{
    const t = document.getElementById('issueText').value.trim(); if(!t){ alert('Please type a short description of the activity/issue.'); return; }
    analyzeIssue(t);
  });

  function analyzeIssue(text){
    const tokens = tokenize(text);
    const out = document.getElementById('analysisResults'); out.innerHTML='';
    // Articles
    const artScores = ARTICLES_PART3.map(a=> ({...a, score: scoreMatch([a.id,a.title].concat(a.text.split(/[^a-z0-9]+/i)), tokens)})).sort((a,b)=>b.score-a.score);
    const topArts = artScores.filter(a=>a.score>0).slice(0,6);
    if(topArts.length){
      out.appendChild(el('div',{}, el('div',{style:'font-weight:700'}, 'Relevant Constitutional Articles')));
      topArts.forEach(a=> out.appendChild(el('div',{class:'section'}, el('div',{style:'font-weight:700'}, `Article ${a.id} — ${a.title}`), el('div',{class:'small'}, a.text), el('div',{}, el('button',{class:'btn ghost', onclick:()=> openArticle(a.id)}, 'Read')))));
    }

    // Embedded IPC matches
    const ipcMatches = EMBEDDED_IPC.sections.filter(s => tokens.some(tok => (s.section + ' ' + (s.title||'') + ' ' + s.text).toLowerCase().includes(tok))).slice(0,30);
    if(ipcMatches.length){
      out.appendChild(el('div',{}, el('div',{style:'font-weight:700;margin-top:8px'}, 'Matches in embedded IPC sections')));
      ipcMatches.forEach(s=> out.appendChild(el('div',{class:'section'}, el('div',{style:'font-weight:700'}, `§${s.section} — ${s.title}`), el('div',{class:'small'}, s.text.slice(0,400)+'...'), el('div',{}, el('button',{class:'btn', onclick:()=> openSectionModal('IPC', s.section, s.title, s.text)}, 'Open Section')))));
    }

    // Imported full acts search
    const importedMatches = [];
    Object.values(state.fullActs||{}).forEach(act=>{
      (act.sections||[]).forEach(sec=>{
        const combined = (sec.section + ' ' + (sec.title||'') + ' ' + (sec.text||'')).toLowerCase();
        if(tokens.some(tok => combined.includes(tok))) importedMatches.push({act: act.code, section: sec.section, title: sec.title, text: sec.text});
      });
    });
    if(importedMatches.length){
      out.appendChild(el('div',{}, el('div',{style:'font-weight:700;margin-top:8px'}, 'Matches in imported Acts')));
      importedMatches.slice(0,30).forEach(m=> out.appendChild(el('div',{class:'section'}, el('div',{style:'font-weight:700'}, `${m.act} §${m.section} — ${m.title||''}`), el('div',{class:'small'}, (m.text||'').slice(0,400)+'...'), el('div',{}, el('button',{class:'btn', onclick:()=> openSectionModal(m.act, m.section, m.title||'', m.text||'')}, 'Open Section')))));
    }

    if(!topArts.length && !ipcMatches.length && !importedMatches.length){
      out.appendChild(el('div',{class:'small'}, 'No direct matches found. Try keywords: "arrest", "murder", "theft", "rape", "bail", "cheating". You can also import full IPC/CrPC/Evidence JSON for exhaustive search.'));
    }
  }

  function openArticle(id){
    const a = ARTICLES_PART3.find(x=>x.id===id); if(!a) return;
    const overlay = el('div',{style:'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:999'});
    const box = el('div',{style:'width:min(800px,96vw);max-height:90vh;overflow:auto;background:var(--panel);padding:18px;border-radius:12px'});
    box.appendChild(el('div',{}, el('div',{style:'font-weight:800'}, `Article ${a.id} — ${a.title}`), el('div',{class:'small', style:'margin-top:8px'}, a.text), el('div',{style:'margin-top:12px'}, el('button',{class:'btn ghost', onclick:()=> overlay.remove()}, 'Close'))));
    overlay.appendChild(box); document.body.appendChild(overlay);
  }

  /* ---------- wire global search for quick filters ---------- */
  document.getElementById('globalSearch').addEventListener('input', (e)=>{
    const q = e.target.value.trim().toLowerCase();
    // filter books and embedded IPC titles quickly
    renderBooks(q);
    // quick highlight imported acts
    if(!q){ renderFullActsList(); return; }
    const matches = Object.values(state.fullActs||{}).filter(a => (a.code + ' ' + a.title).toLowerCase().includes(q));
    const wrap = document.getElementById('fullActsList'); wrap.innerHTML=''; if(matches.length) matches.forEach(act=> wrap.appendChild(el('div',{class:'section'}, el('div',{style:'font-weight:700'}, `${act.code} — ${act.title}`), el('div',{class:'small'}, `${act.sections?act.sections.length:0} sections`), el('div',{}, el('button',{class:'btn', onclick:()=> viewActSections(act.code)}, 'View')))));
  });

  /* ---------- add book modal ---------- */
  document.getElementById('addBookBtn').addEventListener('click', ()=>{
    const overlay = el('div',{style:'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:999'});
    const box = el('div',{style:'width:min(720px,96vw);background:var(--panel);padding:14px;border-radius:12px'});
    box.innerHTML = `<h3 style="margin:0 0 6px">Add a Law Book</h3>
      <div class="sub">Stored locally in your browser</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
        <input id="nb_title" placeholder="Title" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.04);background:var(--soft);color:var(--text)" />
        <input id="nb_author" placeholder="Author" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.04);background:var(--soft);color:var(--text)" />
        <input id="nb_year" placeholder="Year" type="number" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.04);background:var(--soft);color:var(--text)" />
        <input id="nb_category" placeholder="Category" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.04);background:var(--soft);color:var(--text)" />
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button id="nb_cancel" class="btn ghost">Cancel</button>
        <button id="nb_save" class="btn">Save</button>
      </div>`;
    overlay.appendChild(box); document.body.appendChild(overlay);
    document.getElementById('nb_cancel').addEventListener('click', ()=> overlay.remove());
    document.getElementById('nb_save').addEventListener('click', ()=>{
      const t = document.getElementById('nb_title').value.trim(); if(!t) return alert('Title required');
      const nb = { id: Math.max(0,...state.books.map(b=>b.id))+1, title: t, author: document.getElementById('nb_author').value.trim(), year: Number(document.getElementById('nb_year').value)||null, category: document.getElementById('nb_category').value.trim()||'General' };
      state.books.push(nb); save(); renderBooks(); overlay.remove();
    });
  });

  /* ---------- theme toggle ---------- */
  document.getElementById('themeToggle').addEventListener('click', ()=>{ state.theme = state.theme==='light' ? 'dark' : 'light'; applyTheme(); save(); });
  function applyTheme(){ document.documentElement.setAttribute('data-theme', state.theme); }

  /* ---------- initial rendering ---------- */
  function init(){
    applyTheme();
    renderIPC();
    renderCrPC();
    renderEvidence();
    renderFullActsList();
    renderBooks();
  }
  init();
  </script>
</body>
</html>
